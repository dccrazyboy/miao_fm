{% extends "base.html" %}

{% block extern_head %}
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="stylesheet" type="text/css" href="/static/css/demo.css">
    <script type="text/javascript" src="/static/js/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="/static/jquery-jplayer/jquery.jplayer.js"></script>
    <script type="text/javascript" src="/static/ttw-music-player.js"></script>
{% end %}

{% block content %}
    <div id="text_title">
        <h1>Miao FM</h1>
        <p>Also see https://github.com/dccrazyboy/miao_fm</p>
    </div>
    <script type="text/javascript">
        $(document).ready(function(){
            myPlaylist = [];
            $.ajax({
                type:'get',
                url: '/api/music/next/',
                dataType:'json',
                async : false,
                success:function(data){
                   // console.info(data);
                   myPlaylist = []
                   var music = {};
                   music['mp3'] = data.music_url;
                   music['title'] = data.music_name;
                   music['artist'] = data.music_artist;
                   myPlaylist.push(music);
                 }
            });
            // console.info(myPlaylist);
            var description = '';

            $('body').ttwMusicPlayer(myPlaylist, {
                autoplay:true, 
                description:description,
                jPlayer:{
                    swfPath:'/static/jquery-jplayer'
                },
                ratingCallback:function(index, playlistItem, rating){
                    console.info("song over");
                }
            });

            $('.tracklist').hide();
            $('.rating').hide();
        });
    </script>
{% end %}

